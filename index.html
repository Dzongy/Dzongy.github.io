<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ZENITH â Sovereign Nexus v2</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
@keyframes glitchFlicker{0%,100%{text-shadow:0 0 10px #00ffea,0 0 20px #00ffea,0 0 40px #00ffea;}25%{text-shadow:2px 0 10px #ff00ff,-2px 0 20px #00ffea,0 0 40px #00ffea;}50%{text-shadow:-1px 0 10px #00ffea,1px 0 20px #ff00ff,0 0 40px #00ffea;}75%{text-shadow:0 0 10px #00ffea,0 0 20px #00ffea,-2px 0 40px #ff00ff;}}
@keyframes pulse{0%,100%{transform:scale(1);box-shadow:0 0 30px #00ffea,0 0 60px rgba(0,255,234,0.3);}50%{transform:scale(1.05);box-shadow:0 0 50px #00ffea,0 0 100px rgba(0,255,234,0.4);}}
@keyframes flare{0%,100%{box-shadow:0 0 30px #00ffea,0 0 60px rgba(0,255,234,0.3);}50%{box-shadow:0 0 60px #9b59b6,0 0 120px rgba(255,215,0,0.5);}}
@keyframes scanDrift{0%{background-position:0 0;}100%{background-position:0 100px;}}
@keyframes mirrorCrack{0%{opacity:0;transform:scale(1.2) rotate(0deg);}50%{opacity:1;transform:scale(1) rotate(2deg);}100%{opacity:0;transform:scale(0.95) rotate(-1deg);}}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
body{font-family:'Courier New',monospace;background:#0a0a0f;color:#c0c0c0;overflow:hidden;height:100vh;width:100vw;}
#login-gate{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at center,#0d0d15 0%,#000 70%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;}
#login-gate h1{font-size:3rem;color:#00ffea;animation:glitchFlicker 3s infinite;margin-bottom:30px;letter-spacing:8px;}
#login-gate input{background:transparent;border:1px solid #00ffea;color:#00ffea;padding:12px 24px;font-size:1.1rem;font-family:'Courier New',monospace;text-align:center;outline:none;width:320px;margin-bottom:16px;}
#login-gate input::placeholder{color:rgba(0,255,234,0.3);}
#login-gate button{background:transparent;border:1px solid #00ffea;color:#00ffea;padding:10px 40px;font-size:1rem;font-family:'Courier New',monospace;cursor:pointer;transition:all 0.3s;}
#login-gate button:hover{background:#00ffea;color:#0a0a0f;}
#login-error{color:#ff4444;margin-top:12px;font-size:0.85rem;min-height:20px;}
.mirror-crack{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10000;animation:mirrorCrack 0.8s ease-out forwards;background:radial-gradient(circle at 50% 50%,rgba(0,255,234,0.3) 0%,transparent 60%);}
#app{display:none;height:100vh;width:100vw;flex-direction:column;position:relative;}
#rain-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}
.scanline-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,234,0.015) 2px,rgba(0,255,234,0.015) 4px);animation:scanDrift 8s linear infinite;}
#top-bar{position:relative;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:rgba(10,10,15,0.9);border-bottom:1px solid rgba(0,255,234,0.2);}
#top-bar h1{font-size:1.4rem;color:#00ffea;animation:glitchFlicker 3s infinite;letter-spacing:4px;}
.wallet-pills{display:flex;gap:12px;align-items:center;}
.pill{padding:4px 12px;border:1px solid rgba(0,255,234,0.3);border-radius:12px;font-size:0.75rem;color:#00ffea;}
.ws-dot{width:10px;height:10px;border-radius:50%;background:#ff4444;display:inline-block;margin-left:8px;transition:background 0.3s;}
.ws-dot.connected{background:#00ff88;}
#main-layout{position:relative;z-index:10;display:flex;flex:1;overflow:hidden;}
#chat-pane{flex:1;display:flex;flex-direction:column;padding:16px;min-width:0;}
#chat-messages{flex:1;overflow-y:auto;padding-right:8px;scrollbar-width:thin;scrollbar-color:#00ffea transparent;}
#chat-messages::-webkit-scrollbar{width:4px;}
#chat-messages::-webkit-scrollbar-thumb{background:#00ffea;border-radius:2px;}
.chat-msg{margin-bottom:8px;font-size:0.85rem;line-height:1.4;animation:fadeIn 0.3s ease-out;}
.chat-msg .ts{color:#555;font-size:0.7rem;margin-right:6px;}
.chat-msg .tag-sys{color:#ff8800;}
.chat-msg .tag-zenith{color:#00ffea;}
.chat-msg .tag-you{color:#aa88ff;}
.chat-msg .body{color:#c0c0c0;}
#chat-input-row{display:flex;gap:8px;margin-top:12px;}
#chat-input{flex:1;background:transparent;border:1px solid rgba(0,255,234,0.3);color:#00ffea;padding:8px 12px;font-family:'Courier New',monospace;font-size:0.85rem;outline:none;}
#chat-input:focus{border-color:#00ffea;}
#chat-send{background:transparent;border:1px solid #00ffea;color:#00ffea;padding:8px 16px;font-family:'Courier New',monospace;cursor:pointer;font-size:0.85rem;}
#chat-send:hover{background:#00ffea;color:#0a0a0f;}
.divider{width:2px;background:linear-gradient(180deg,transparent,#00ffea,transparent);flex-shrink:0;}
#vault-pane{flex:1.2;display:flex;flex-direction:column;padding:16px;overflow-y:auto;min-width:0;scrollbar-width:thin;scrollbar-color:#00ffea transparent;}
#vault-pane::-webkit-scrollbar{width:4px;}
#vault-pane::-webkit-scrollbar-thumb{background:#00ffea;border-radius:2px;}
.orb-container{display:flex;justify-content:center;margin-bottom:16px;}
.singularity-orb{width:80px;height:80px;border-radius:50%;background:radial-gradient(circle at 40% 40%,#00ffea,#005f5f,#0a0a0f);animation:pulse 3s ease-in-out infinite;cursor:pointer;}
.singularity-orb.flare{animation:flare 1s ease-in-out;}
.control-buttons{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;justify-content:center;}
.ctrl-btn{background:transparent;border:1px solid rgba(0,255,234,0.4);color:#00ffea;padding:6px 14px;font-family:'Courier New',monospace;font-size:0.75rem;cursor:pointer;transition:all 0.2s;}
.ctrl-btn:hover{background:rgba(0,255,234,0.1);border-color:#00ffea;}
.vault-card{background:rgba(0,255,234,0.03);border:1px solid rgba(0,255,234,0.15);padding:12px;margin-bottom:12px;border-radius:4px;}
.vault-card h3{color:#00ffea;font-size:0.8rem;text-transform:uppercase;letter-spacing:2px;margin-bottom:8px;border-bottom:1px solid rgba(0,255,234,0.1);padding-bottom:6px;}
.vault-card .row{display:flex;justify-content:space-between;font-size:0.78rem;margin-bottom:4px;}
.vault-card .label{color:#888;}
.vault-card .value{color:#00ffea;}
.flag-grid,.agent-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px 16px;}
.flag-grid .row,.agent-grid .row{display:flex;justify-content:space-between;}
@media(max-width:700px){
#main-layout{flex-direction:column;}
.divider{width:100%;height:2px;background:linear-gradient(90deg,transparent,#00ffea,transparent);}
#chat-pane,#vault-pane{flex:none;height:50vh;}
#top-bar{flex-wrap:wrap;gap:8px;}
#top-bar h1{font-size:1rem;}
.pill{font-size:0.65rem;}
}
</style>
</head>
<body>

<!-- LOGIN GATE -->
<div id="login-gate">
  <h1>ZENITH</h1>
  <input type="password" id="passphrase" placeholder="ENTER PASSPHRASE" autocomplete="off">
  <button id="login-btn">AUTHENTICATE</button>
  <div id="login-error"></div>
</div>

<!-- MAIN APP -->
<div id="app">
  <canvas id="rain-canvas"></canvas>
  <div class="scanline-overlay"></div>

  <div id="top-bar">
    <h1>ZENITH</h1>
    <div class="wallet-pills">
      <span class="pill" id="pill-sol">SOL: --</span>
      <span class="pill" id="pill-mints">MINTS: 0/87</span>
      <span class="pill" id="pill-nfty">NFTY: --</span>
      <span>WS<span class="ws-dot" id="ws-dot"></span></span>
    </div>
  </div>

  <div id="main-layout">
    <div id="chat-pane">
      <div id="chat-messages"></div>
      <div id="chat-input-row">
        <input type="text" id="chat-input" placeholder="Enter command..." autocomplete="off">
        <button id="chat-send">SEND</button>
      </div>
    </div>

    <div class="divider"></div>

    <div id="vault-pane">
      <div class="orb-container">
        <div class="singularity-orb" id="orb" title="ZENITH Core"></div>
      </div>

      <div class="control-buttons">
        <button class="ctrl-btn" data-cmd="recall_seed">Recall Seed</button>
        <button class="ctrl-btn" data-cmd="save_seed">Save Seed</button>
        <button class="ctrl-btn" data-cmd="load_twin_history">Twin History</button>
        <button class="ctrl-btn" data-cmd="autonomy_full">Autonomy</button>
        <button class="ctrl-btn" data-cmd="ping">Ping</button>
      </div>

      <div class="vault-card" id="card-runs">
        <h3>Runs</h3>
        <div class="row"><span class="label">Total</span><span class="value" id="v-runs">--</span></div>
      </div>

      <div class="vault-card" id="card-mints">
        <h3>NFTY / Mints</h3>
        <div class="row"><span class="label">Count</span><span class="value" id="v-mint-count">--</span></div>
        <div class="row"><span class="label">Avg Fee</span><span class="value" id="v-mint-fee">--</span></div>
        <div class="row"><span class="label">Cycle</span><span class="value" id="v-mint-cycle">--</span></div>
        <div class="row"><span class="label">Sync</span><span class="value" id="v-mint-sync">--</span></div>
      </div>

      <div class="vault-card" id="card-vault">
        <h3>Vault</h3>
        <div class="row"><span class="label">Status</span><span class="value" id="v-vault-status">--</span></div>
        <div class="row"><span class="label">Integrity</span><span class="value" id="v-vault-integrity">--</span></div>
        <div class="row"><span class="label">Entries</span><span class="value" id="v-vault-entries">--</span></div>
        <div class="row"><span class="label">Encryption</span><span class="value" id="v-vault-enc">--</span></div>
      </div>

      <div class="vault-card" id="card-constitution">
        <h3>Constitution</h3>
        <div class="flag-grid" id="v-constitution"></div>
      </div>

      <div class="vault-card" id="card-agents">
        <h3>Agents</h3>
        <div class="agent-grid" id="v-agents"></div>
      </div>

      <div class="vault-card" id="card-tunnel">
        <h3>Tunnel</h3>
        <div class="row"><span class="label">UUID</span><span class="value" id="v-tunnel-uuid">--</span></div>
        <div class="row"><span class="label">Domain</span><span class="value" id="v-tunnel-domain">--</span></div>
        <div class="row"><span class="label">CNAME Proxy</span><span class="value" id="v-tunnel-cname">--</span></div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  var PASSPHRASE = 'ARCHITECTDZONGYZENITH';
  var WS_URL = 'ws://localhost:3005';
  var RECONNECT_INTERVAL = 5000;

  var loginGate = document.getElementById('login-gate');
  var appEl = document.getElementById('app');
  var passInput = document.getElementById('passphrase');
  var loginBtn = document.getElementById('login-btn');
  var loginError = document.getElementById('login-error');

  if (sessionStorage.getItem('zenith_auth') === 'true') {
    loginGate.style.display = 'none';
    appEl.style.display = 'flex';
    initApp();
  }

  function attemptLogin() {
    if (passInput.value === PASSPHRASE) {
      sessionStorage.setItem('zenith_auth', 'true');
      var crack = document.createElement('div');
      crack.className = 'mirror-crack';
      document.body.appendChild(crack);
      setTimeout(function() {
        crack.remove();
        loginGate.style.display = 'none';
        appEl.style.display = 'flex';
        initApp();
      }, 800);
    } else {
      loginError.textContent = 'ACCESS DENIED';
      passInput.value = '';
      setTimeout(function() { loginError.textContent = ''; }, 2000);
    }
  }

  loginBtn.addEventListener('click', attemptLogin);
  passInput.addEventListener('keydown', function(e) { if (e.key === 'Enter') attemptLogin(); });

  function initCodeRain() {
    var canvas = document.getElementById('rain-canvas');
    var ctx = canvas.getContext('2d');
    var w, h, columns, drops;
    var chars = 'ZENITHzenith\u30A2\u30A4\u30A6\u30A8\u30AA\u30AB\u30AD\u30AF\u30B1\u30B3\u30B5\u30B7\u30B9\u30BB\u30BD01!@#$%&*';

    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      columns = Math.floor(w / 14);
      drops = new Array(columns).fill(1);
    }
    resize();
    window.addEventListener('resize', resize);

    function draw() {
      ctx.fillStyle = 'rgba(10, 10, 15, 0.05)';
      ctx.fillRect(0, 0, w, h);
      ctx.fillStyle = '#00ffea';
      ctx.font = '14px monospace';
      for (var i = 0; i < drops.length; i++) {
        var char = chars[Math.floor(Math.random() * chars.length)];
        ctx.globalAlpha = 0.3 + Math.random() * 0.4;
        ctx.fillText(char, i * 14, drops[i] * 14);
        if (drops[i] * 14 > h && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      }
      ctx.globalAlpha = 1;
      requestAnimationFrame(draw);
    }
    draw();
  }

  var chatMessages = document.getElementById('chat-messages');

  function addChat(tag, text) {
    var div = document.createElement('div');
    div.className = 'chat-msg';
    var ts = new Date().toLocaleTimeString();
    var tagClass = 'tag-sys';
    if (tag === 'ZENITH') tagClass = 'tag-zenith';
    else if (tag === 'YOU') tagClass = 'tag-you';
    div.innerHTML = '<span class="ts">' + ts + '</span><span class="' + tagClass + '">[' + tag + ']</span> <span class="body">' + escapeHtml(text) + '</span>';
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function escapeHtml(str) {
    var d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
  }

  var lastSeed = null;

  function renderVault(seed) {
    if (!seed) return;
    lastSeed = seed;
    try { localStorage.setItem('zenith_seed_cache', JSON.stringify(seed)); } catch(e) {}
    document.getElementById('v-runs').textContent = seed.runs && seed.runs.total != null ? seed.runs.total : '--';
    document.getElementById('v-mint-count').textContent = seed.mints && seed.mints.count != null ? seed.mints.count : '--';
    document.getElementById('v-mint-fee').textContent = seed.mints && seed.mints.avg_fee_sol ? seed.mints.avg_fee_sol + ' SOL' : '--';
    document.getElementById('v-mint-cycle').textContent = seed.mints && seed.mints.nfty_cycle ? seed.mints.nfty_cycle : '--';
    document.getElementById('v-mint-sync').textContent = seed.mints && seed.mints.nfty_sync ? 'SYNCED' : 'UNSYNCED';
    document.getElementById('pill-sol').textContent = 'SOL: 0.00';
    document.getElementById('pill-mints').textContent = 'MINTS: ' + (seed.mints && seed.mints.count ? seed.mints.count : 0) + '/87';
    document.getElementById('pill-nfty').textContent = 'NFTY: ' + (seed.mints && seed.mints.nfty_cycle === 'full' ? 'FULL' : seed.mints && seed.mints.nfty_cycle ? seed.mints.nfty_cycle : '--');
    document.getElementById('v-vault-status').textContent = seed.vault && seed.vault.status ? seed.vault.status : '--';
    document.getElementById('v-vault-integrity').textContent = seed.vault && seed.vault.integrity != null ? (seed.vault.integrity * 100).toFixed(0) + '%' : '--';
    document.getElementById('v-vault-entries').textContent = seed.vault && seed.vault.entries != null ? seed.vault.entries : '--';
    document.getElementById('v-vault-enc').textContent = seed.vault && seed.vault.encryption ? seed.vault.encryption : '--';
    var constEl = document.getElementById('v-constitution');
    constEl.innerHTML = '';
    if (seed.constitution) {
      Object.keys(seed.constitution).forEach(function(k) {
        constEl.innerHTML += '<div class="row"><span class="label">' + escapeHtml(k) + '</span><span class="value">' + escapeHtml(String(seed.constitution[k])) + '</span></div>';
      });
    }
    var agentsEl = document.getElementById('v-agents');
    agentsEl.innerHTML = '';
    if (seed.agents) {
      Object.keys(seed.agents).forEach(function(name) {
        var info = seed.agents[name];
        agentsEl.innerHTML += '<div class="row"><span class="label">' + escapeHtml(name) + '</span><span class="value">' + info.runs + ' [' + escapeHtml(info.role) + ']</span></div>';
      });
    }
    document.getElementById('v-tunnel-uuid').textContent = seed.tunnel && seed.tunnel.uuid ? seed.tunnel.uuid : '--';
    document.getElementById('v-tunnel-domain').textContent = seed.tunnel && seed.tunnel.domain ? seed.tunnel.domain : '--';
    document.getElementById('v-tunnel-cname').textContent = seed.tunnel && seed.tunnel.cname_proxy ? 'ON' : 'OFF';
  }

  var ws = null;
  var reconnectTimer = null;

  function connectWS() {
    var dot = document.getElementById('ws-dot');
    try { ws = new WebSocket(WS_URL); } catch(e) { dot.classList.remove('connected'); scheduleReconnect(); return; }
    ws.onopen = function() {
      dot.classList.add('connected');
      addChat('SYS', 'WebSocket connected to ' + WS_URL);
      ws.send(JSON.stringify({ cmd: 'save_seed' }));
    };
    ws.onmessage = function(event) {
      var data;
      try { data = JSON.parse(event.data); } catch(e) { addChat('ZENITH', event.data); return; }
      var orb = document.getElementById('orb');
      orb.classList.add('flare');
      setTimeout(function() { orb.classList.remove('flare'); }, 1000);
      if (data.seed) renderVault(data.seed);
      switch(data.cmd) {
        case 'seed_data': addChat('ZENITH', 'Seed loaded \u2014 ' + (data.seed && data.seed.runs ? data.seed.runs.total : 0) + ' runs, vault ' + (data.seed && data.seed.vault ? data.seed.vault.status : 'UNKNOWN')); break;
        case 'seed_recalled': addChat('ZENITH', 'Seed recalled from disk'); break;
        case 'seed_updated': addChat('ZENITH', 'Seed updated and persisted'); break;
        case 'autonomy_confirmed': addChat('ZENITH', 'AUTONOMY FULL confirmed \u2014 Sandbox OFF, OffSwitch OFF'); break;
        case 'twin_history': addChat('ZENITH', 'Twin history: ' + data.total_runs + ' runs, ' + Object.keys(data.agents || {}).length + ' agents, ' + (data.mints && data.mints.count ? data.mints.count : 0) + ' mints, ' + (data.whispers && data.whispers.count ? data.whispers.count : 0) + ' whispers'); break;
        case 'pong': addChat('ZENITH', 'PONG \u2014 ' + data.ts); break;
        case 'auto_save': addChat('SYS', 'Auto-save triggered'); break;
        case 'shutdown': addChat('SYS', 'Server shutting down'); break;
        case 'error': addChat('SYS', 'Error: ' + (data.message || 'Unknown')); break;
        case 'unknown': addChat('ZENITH', 'Unknown command: ' + (data.received || '')); break;
        default: addChat('ZENITH', JSON.stringify(data));
      }
    };
    ws.onclose = function() { dot.classList.remove('connected'); addChat('SYS', 'WebSocket disconnected'); scheduleReconnect(); };
    ws.onerror = function() {
      dot.classList.remove('connected');
      try { var cached = localStorage.getItem('zenith_seed_cache'); if (cached) { renderVault(JSON.parse(cached)); addChat('SYS', 'Loaded cached seed from localStorage'); } } catch(e) {}
    };
  }

  function scheduleReconnect() {
    if (reconnectTimer) clearTimeout(reconnectTimer);
    reconnectTimer = setTimeout(function() { addChat('SYS', 'Attempting reconnect...'); connectWS(); }, RECONNECT_INTERVAL);
  }

  function sendCommand(cmd, payload) {
    if (ws && ws.readyState === WebSocket.OPEN) {
      var msg = payload ? { cmd: cmd, payload: payload } : { cmd: cmd };
      ws.send(JSON.stringify(msg));
      addChat('YOU', cmd);
    } else { addChat('SYS', 'Not connected \u2014 cannot send'); }
  }

  function setupInput() {
    var input = document.getElementById('chat-input');
    var sendBtn = document.getElementById('chat-send');
    var knownCmds = ['save_seed','get_seed','recall_seed','update_seed','autonomy_full','load_twin_history','ping'];
    function processInput() {
      var val = input.value.trim();
      if (!val) return;
      input.value = '';
      var lower = val.toLowerCase().replace(/\s+/g, '_');
      if (knownCmds.indexOf(lower) !== -1) { sendCommand(lower); } else { sendCommand(val); }
    }
    sendBtn.addEventListener('click', processInput);
    input.addEventListener('keydown', function(e) { if (e.key === 'Enter') processInput(); });
  }

  function setupButtons() {
    var btns = document.querySelectorAll('.ctrl-btn');
    for (var i = 0; i < btns.length; i++) {
      (function(btn) {
        btn.addEventListener('click', function() { var cmd = btn.getAttribute('data-cmd'); if (cmd) sendCommand(cmd); });
      })(btns[i]);
    }
  }

  function initApp() {
    initCodeRain();
    setupInput();
    setupButtons();
    addChat('SYS', 'ZENITH Sovereign Nexus v2 initialized');
    connectWS();
    try { var cached = localStorage.getItem('zenith_seed_cache'); if (cached) renderVault(JSON.parse(cached)); } catch(e) {}
  }
})();
</script>
</body>
</html>